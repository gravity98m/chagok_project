<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.chagok.mapper.abookMapper">
  
  <!-- 가계부 목록 -->
  <select id="getAbookList" resultType="AbookVO">
	select * from account_book as ab inner join category as c on ab.ctno=c.ctno where mno=#{mno}
  </select>
  
  <!-- 카테고리 목록 -->
  <select id="cateList" resultType="CategoryVO">
  	select * from account_book as ab inner join category as ct on ab.ctno=ct.ctno
  </select>
  

  <!-- 가계부 저장(수정) -->
    <update id="setAbookList">
	update account_book set 
	ab_inout=#{ab_inout},ab_date=#{ab_date},ab_content=#{ab_content},ab_method=#{ab_method},ab_memo=#{ab_memo},ctno=#{ctno}, ab_amount=#{ab_amount}
	where abno=#{abno};
	</update>
  
  
  
 	<!-- //////////////////// MJ //////////////////// -->
	
	<sql id="wh1">
		where mno=#{mno} 
		and p_month=#{pMonth}
	</sql>
	
	<!-- 상위 카테고리 -->
	<select id="getctTop" resultType="String">
		select ct_top
		from category
		where ct_inout=1 and ct_lev=0 and ctno != 12;
	</select>
	
	<!-- 1. 예산 유무 -->
	<select id="chkBud" resultType="int">
		select count(pno) from plan 
		<include refid="wh1"/>;
	</select>
	 
	<!-- 2. 예산 조회 -->
	<select id="getBud" resultType="map">
		select ct.ct_top ct_top, p_amount
		from plan p 
		inner join category ct 
		on p.ctno=ct.ctno
		<include refid="wh1"/>
		group by ct.ct_top;
	</select>
	
	<!-- 3. 예산 설정 -->
	<insert id="setBud" parameterType="map">
		insert into plan (mno, p_month, p_amount, ctno)
		values
		<foreach item="i" collection="insertList" separator=",">
			(#{i.mno}, #{i.p_month}, #{i.p_amount}, #{i.ctno})
		</foreach>
	</insert>
  
  </mapper>