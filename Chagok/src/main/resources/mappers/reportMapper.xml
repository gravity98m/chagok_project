<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.chagok.mapper.reportMapper">
  
  	<!-- Test -->
  	<select id="rptTest" resultType="AbookVO">
  		select * from account_book
  		where mno=#{mno}
  	</select>

  	<!-- //////////////////////// dateReport //////////////////////// -->
  
  
  	<!-- //////////////////////// cateReport //////////////////////// -->
  	<!-- 1.최다 지출 카테고리 -->
	<select id="cateCnt" resultType="ReportVO">
		select count(ab.abno) cateCnt, ct.ct_top cateName
		from account_book ab inner join category ct on ab.ctno=ct.ctno 
		where ab.mno=#{mno} and ab_inout=1 and
		ab.ab_date between LAST_DAY(NOW() - interval 1 month) + interval 1 DAY and LAST_DAY(NOW()) 
		group by cateName
		order by cateCnt desc;
	</select>	
	
  	<!-- 2.최대 지출 카테고리 -->
	<select id="cateSum" resultType="ReportVO">
		select sum(ab.ab_amount) cateSum, ct.ct_top cateName
		from account_book ab inner join category ct on ab.ctno=ct.ctno 
		where ab.mno=#{mno} and ab_inout=1 and
		ab.ab_date between LAST_DAY(NOW() - interval 1 month) + interval 1 DAY and LAST_DAY(NOW()) 
		group by cateName
		order by cateSum desc;
	</select>
	
	<!-- 3.챌린지 추천 -->
	
	<!-- 4.카드 추천 -->
	
  </mapper>